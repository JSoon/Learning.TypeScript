<h1>函数 (Functions)</h1>

<h2>目录</h2>

## 介绍

在JavaScript中，函数是任何应用程序的基础组成部分。它们是构建抽象层，模拟类，信息隐藏，和模块的途径手段。在TypeScript中，虽然有着类，命名空间和模块的概念，但是函数仍然扮演着至关重要的角色，即***任务执行***。

TypeScript也为标准的JavaScript函数增加了一些新的特性，使其更容易被使用。

## 函数 (Functions)

和JavaScript一样，TypeScript的函数也能够通过命名函数或者匿名函数的方式来进行创建。这两种方式使得我们能够根据不同场景选择最适合的创建方式，无论是在构建一系列的API函数或者是仅被使用一次的函数。

```js
// Named function 命名函数
function add(x, y) {
  return x + y;
}

// Anonymous function 匿名函数
let myAdd = function(x, y) {
  return x + y;
};
```

和JavaScript一样，函数能够引用函数体外部的变量。当我们这样做时，函数则会去***捕获***这些变量。这种机制的原理并不是我们这篇文章需要讨论的内容，但是深刻理解了这种机制对我们使用JavaScript和TypeScript是非常重要的。

> 上面的机制应该是指闭包(Closure)：函数能够访问其被创建时所处的上下文环境。

```js
let z = 100;

function addToZ(x, y) {
  return x + y + z; // 函数内部能够访问其被创建时上下文中的变量z
}
```

## 函数类型 (Function Types)

### 为函数定义类型 (Typing the function)

让我们为先前简单的函数定义类型：

```ts
// 函数名后的: number表示该函数的返回类型是数字
function add(x: number, y: number): number {
  return x + y;
}

// 根据参数类型，TypeScript也能判断出返回值是一个number类型
function add(x: number, y: number) {
  return x + y; // number
}

let myAdd = function(x: number, y: number): number {
  return x + y;
};
```

如上例，我们能够显式地为为函数定义返回值类型。TypeScript也能够根据返回语句自动判断返回值类型，所以在很多情况下我们也能够不对函数进行类型定义（即通常可以忽略）。

### 书写完整函数类型 (Writing the function type)

我们已经定义了函数类型，下面就来书写一下完整的函数类型：

```ts
// 完整的函数类型包括两部分：
// 1. 参数类型部分，即 (x: number, y: number)
// 2. 返回类型部分，即 number
let myAdd: (x: number, y: number) => number = function(
  x: number,
  y: number
): number {
  return x + y;
};

// 因为参数类型部分的参数名为形式参数，目的是为了增强程序的可读性，所以命名通常应该有一定的语义。
// 如下面的写法：
let myAdd: (baseValue: number, increment: number) => number = function(
  x: number,
  y: number
): number {
  return x + y;
};
```

回顾接口一章，我们也能通过接口来描述完整的函数类型，其作用是完全一致的：

```ts
// 定义add函数接口类型
interface Add {
  (baseValue: number, increment: number): number
}

let myAdd: Add = function(
  x: number,
  y: number
) {
  return x + y
}
```

> 注：当我们对函数进行完整类型书写时，参数部分和返回类型部分缺一不可。这也意味着，即使函数不返回任何值，我们也需要使用`void`进行声明，以保证函数类型的完整性。

写到这里我们会发现，假如函数体中引用了其他变量呢？这些变量的类型需要体现在函数类型定义中吗？答案是否定的，实际上，这些被引用的外部变量作为“隐藏状态”而存在，并且不是组成API的一部分。

### 推测函数类型 (Inferring the types)

下面的例子解释了TypeScript对函数的类型推测机制：

```ts
// myAdd has the full function type
// 左侧myAdd变量未定义类型，但右侧的匿名函数进行了完整的函数类型定义
let myAdd = function(x: number, y: number): number {
  return x + y;
};

// The parameters 'x' and 'y' have the type number
// 左侧myAdd变量定义了完整函数类型，但右侧的匿名函数未进行类型定义
let myAdd: (baseValue: number, increment: number) => number = function(x, y) {
  return x + y;
};
```

这叫做“按上下文归类”，是类型推论的一种。它帮助我们更好地为程序指定类型（这里我理解为减少冗余代码，使得程序在看起来更简洁的前提下，又不失去其类型定义的完整性）。



